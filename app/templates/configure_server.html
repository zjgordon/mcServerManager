{% extends "base.html" %}

{% block title %}Configure Minecraft Server{% endblock %}

{% block content %}
    <h2 class="mt-4">Configure Server - Version {{ version }}</h2>
    
    <!-- Memory Usage Summary -->
    {% if memory_summary %}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Memory Usage</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <strong>Total Memory:</strong> {{ memory_summary.total_memory_display }}
                </div>
                <div class="col-md-4">
                    <strong>Allocated:</strong> {{ memory_summary.allocated_memory_display }}
                </div>
                <div class="col-md-4">
                    <strong>Available:</strong> {{ memory_summary.available_memory_display }}
                </div>
            </div>
            <div class="progress mt-2">
                <div class="progress-bar" role="progressbar" 
                     style="width: {{ memory_summary.usage_percentage }}%"
                     aria-valuenow="{{ memory_summary.usage_percentage }}" 
                     aria-valuemin="0" aria-valuemax="100">
                    {{ memory_summary.usage_percentage }}%
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    <form action="{{ url_for('server.configure_server', version_type=version_type, version=version) }}" method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <div class="form-group">
            <label for="server_name">Server Name:</label>
            <input type="text" name="server_name" id="server_name" class="form-control" required value="{{ request.form.server_name or '' }}">
        </div>

        <div class="form-group">
            <label for="level_seed">Level Seed:</label>
            <input type="text" name="level_seed" id="level_seed" class="form-control" value="{{ request.form.level_seed or '' }}">
        </div>

        <div class="form-group">
            <label for="gamemode">Gamemode:</label>
            <select name="gamemode" id="gamemode" class="form-control">
                <option value="survival" {% if request.form.gamemode == 'survival' %}selected{% endif %}>Survival</option>
                <option value="creative" {% if request.form.gamemode == 'creative' %}selected{% endif %}>Creative</option>
                <option value="adventure" {% if request.form.gamemode == 'adventure' %}selected{% endif %}>Adventure</option>
                <option value="spectator" {% if request.form.gamemode == 'spectator' %}selected{% endif %}>Spectator</option>
            </select>
        </div>

        <div class="form-group">
            <label for="difficulty">Difficulty:</label>
            <select name="difficulty" id="difficulty" class="form-control">
                <option value="peaceful" {% if request.form.difficulty == 'peaceful' %}selected{% endif %}>Peaceful</option>
                <option value="easy" {% if request.form.difficulty == 'easy' %}selected{% endif %}>Easy</option>
                <option value="normal" {% if request.form.difficulty == 'normal' %}selected{% endif %}>Normal</option>
                <option value="hard" {% if request.form.difficulty == 'hard' %}selected{% endif %}>Hard</option>
            </select>
        </div>

        <div class="form-group form-check">
            <input type="checkbox" name="hardcore" id="hardcore" class="form-check-input" {% if request.form.get('hardcore') %}checked{% endif %}>
            <label for="hardcore" class="form-check-label">Hardcore</label>
        </div>

        <div class="form-group form-check">
            <input type="checkbox" name="pvp" id="pvp" class="form-check-input" {% if request.form.get('pvp') or request.method == 'GET' %}checked{% endif %}>
            <label for="pvp" class="form-check-label">PVP</label>
        </div>

        <div class="form-group form-check">
            <input type="checkbox" name="spawn_monsters" id="spawn_monsters" class="form-check-input" {% if request.form.get('spawn_monsters') or request.method == 'GET' %}checked{% endif %}>
            <label for="spawn_monsters" class="form-check-label">Spawn Monsters</label>
        </div>

        <div class="form-group">
            <label for="motd">MOTD:</label>
            <input type="text" name="motd" id="motd" class="form-control" value="{{ request.form.motd or '' }}">
        </div>

        <div class="form-group">
            <label for="memory_mb">Memory Allocation (MB):</label>
            <input type="number" name="memory_mb" id="memory_mb" class="form-control" 
                   min="{{ memory_config.min_server_mb }}" 
                   max="{{ memory_config.max_server_mb }}"
                   value="{{ request.form.memory_mb or memory_config.default_server_mb }}" 
                   required>
            <small class="form-text text-muted">
                Min: {{ memory_config.min_server_mb }}MB, Max: {{ memory_config.max_server_mb }}MB, 
                Available: {{ memory_summary.available_memory_mb }}MB
            </small>
        </div>

        <button type="submit" class="btn btn-primary">Create Server</button>
    </form>
{% endblock %}
