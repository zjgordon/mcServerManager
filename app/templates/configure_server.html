{% extends "base.html" %}

{% block title %}Configure Minecraft Server{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-gradient">
            <i class="fas fa-cogs"></i> Configure Server - Version {{ version }}
        </h2>
        <a href="{{ url_for('server.create') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Back to Version Selection
        </a>
    </div>

    <!-- Memory Usage Summary -->
    {% if memory_summary %}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Memory Usage</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <strong>Total Memory:</strong> {{ memory_summary.total_memory_display }}
                </div>
                <div class="col-md-4">
                    <strong>Allocated:</strong> {{ memory_summary.allocated_memory_display }}
                </div>
                <div class="col-md-4">
                    <strong>Available:</strong> {{ memory_summary.available_memory_display }}
                </div>
            </div>
            <div class="progress mt-2">
                <div class="progress-bar" role="progressbar"
                     style="width: {{ memory_summary.usage_percentage }}%"
                     aria-valuenow="{{ memory_summary.usage_percentage }}"
                     aria-valuemin="0" aria-valuemax="100">
                    {{ memory_summary.usage_percentage }}%
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    <div class="card shadow-soft">
        <div class="card-body">
            <form action="{{ url_for('server.configure_server', version_type=version_type, version=version) }}" method="post">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="server_name" class="form-label">
                                <i class="fas fa-server"></i> Server Name
                            </label>
                            <input type="text" name="server_name" id="server_name" class="form-control" required
                                   value="{{ request.form.server_name or '' }}" placeholder="My Minecraft Server"
                                   data-tooltip="Choose a unique name for your server">
                        </div>

                        <div class="form-group">
                            <label for="level_seed" class="form-label">
                                <i class="fas fa-seedling"></i> Level Seed
                            </label>
                            <input type="text" name="level_seed" id="level_seed" class="form-control"
                                   value="{{ request.form.level_seed or '' }}" placeholder="Leave empty for random"
                                   data-tooltip="Optional: Enter a specific seed for world generation">
                        </div>

                        <div class="form-group">
                            <label for="gamemode" class="form-label">
                                <i class="fas fa-gamepad"></i> Gamemode
                            </label>
                            <select name="gamemode" id="gamemode" class="form-control" data-tooltip="Default game mode for new players">
                                <option value="survival" {% if request.form.gamemode == 'survival' %}selected{% endif %}>Survival</option>
                                <option value="creative" {% if request.form.gamemode == 'creative' %}selected{% endif %}>Creative</option>
                                <option value="adventure" {% if request.form.gamemode == 'adventure' %}selected{% endif %}>Adventure</option>
                                <option value="spectator" {% if request.form.gamemode == 'spectator' %}selected{% endif %}>Spectator</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="difficulty" class="form-label">
                                <i class="fas fa-shield-alt"></i> Difficulty
                            </label>
                            <select name="difficulty" id="difficulty" class="form-control" data-tooltip="How challenging the game will be">
                                <option value="peaceful" {% if request.form.difficulty == 'peaceful' %}selected{% endif %}>Peaceful</option>
                                <option value="easy" {% if request.form.difficulty == 'easy' %}selected{% endif %}>Easy</option>
                                <option value="normal" {% if request.form.difficulty == 'normal' %}selected{% endif %}>Normal</option>
                                <option value="hard" {% if request.form.difficulty == 'hard' %}selected{% endif %}>Hard</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-cog"></i> Server Options
                            </label>
                            <div class="form-check">
                                <input type="checkbox" name="hardcore" id="hardcore" class="form-check-input" {% if request.form.get('hardcore') %}checked{% endif %}>
                                <label for="hardcore" class="form-check-label" data-tooltip="Players are permanently banned when they die">
                                    <i class="fas fa-skull"></i> Hardcore
                                </label>
                            </div>

                            <div class="form-check">
                                <input type="checkbox" name="pvp" id="pvp" class="form-check-input" {% if request.form.get('pvp') or request.method == 'GET' %}checked{% endif %}>
                                <label for="pvp" class="form-check-label" data-tooltip="Allow players to fight each other">
                                    <i class="fas fa-sword"></i> PVP
                                </label>
                            </div>

                            <div class="form-check">
                                <input type="checkbox" name="spawn_monsters" id="spawn_monsters" class="form-check-input" {% if request.form.get('spawn_monsters') or request.method == 'GET' %}checked{% endif %}>
                                <label for="spawn_monsters" class="form-check-label" data-tooltip="Allow hostile mobs to spawn">
                                    <i class="fas fa-spider"></i> Spawn Monsters
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="motd" class="form-label">
                                <i class="fas fa-comment"></i> MOTD (Message of the Day)
                            </label>
                            <input type="text" name="motd" id="motd" class="form-control"
                                   value="{{ request.form.motd or '' }}" placeholder="Welcome to my server!"
                                   data-tooltip="Message shown to players in the server list">
                        </div>

                        <div class="form-group">
                            <label for="memory_mb" class="form-label">
                                <i class="fas fa-memory"></i> Memory Allocation (MB)
                            </label>
                            <input type="number" name="memory_mb" id="memory_mb" class="form-control"
                                   min="{{ memory_config.min_server_mb }}"
                                   max="{{ memory_config.max_server_mb }}"
                                   value="{{ request.form.memory_mb or memory_config.default_server_mb }}"
                                   required data-tooltip="Amount of RAM allocated to this server">
                            <small class="form-text text-muted">
                                <i class="fas fa-info-circle"></i>
                                Min: {{ memory_config.min_server_mb }}MB, Max: {{ memory_config.max_server_mb }}MB,
                                Available: {{ memory_summary.available_memory_mb }}MB
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Backup Scheduling Section -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-database"></i> Backup Scheduling (Optional)
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="form-check mb-3">
                                    <input type="checkbox" name="enable_backup_schedule" id="enable_backup_schedule"
                                           class="form-check-input" {% if request.form.get('enable_backup_schedule') %}checked{% endif %}
                                           onchange="toggleBackupSchedule()">
                                    <label for="enable_backup_schedule" class="form-check-label" data-tooltip="Enable automated backups for this server">
                                        <i class="fas fa-clock"></i> Enable Automated Backups
                                    </label>
                                </div>

                                <div id="backupScheduleOptions" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="backup_schedule_type" class="form-label">Schedule Type</label>
                                                <select name="backup_schedule_type" id="backup_schedule_type" class="form-control" data-tooltip="How often to create backups">
                                                    <option value="daily" {% if request.form.backup_schedule_type == 'daily' %}selected{% endif %}>Daily</option>
                                                    <option value="weekly" {% if request.form.backup_schedule_type == 'weekly' %}selected{% endif %}>Weekly</option>
                                                    <option value="monthly" {% if request.form.backup_schedule_type == 'monthly' %}selected{% endif %}>Monthly</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="backup_schedule_time" class="form-label">Backup Time</label>
                                                <input type="time" name="backup_schedule_time" id="backup_schedule_time"
                                                       class="form-control" value="{{ request.form.backup_schedule_time or '02:00' }}"
                                                       data-tooltip="Time of day to create backups">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="backup_retention_days" class="form-label">Retention (Days)</label>
                                                <input type="number" name="backup_retention_days" id="backup_retention_days"
                                                       class="form-control" min="1" max="365"
                                                       value="{{ request.form.backup_retention_days or '30' }}"
                                                       data-tooltip="How many days to keep backup files">
                                            </div>
                                        </div>
                                    </div>
                                    <small class="form-text text-muted">
                                        <i class="fas fa-info-circle"></i>
                                        Backups will be created automatically at the specified time and frequency.
                                        Old backups will be automatically deleted based on the retention period.
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-plus"></i> Create Server
                    </button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
function toggleBackupSchedule() {
    const checkbox = document.getElementById('enable_backup_schedule');
    const options = document.getElementById('backupScheduleOptions');

    if (checkbox.checked) {
        options.style.display = 'block';
    } else {
        options.style.display = 'none';
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleBackupSchedule();
});
</script>
{% endblock %}
